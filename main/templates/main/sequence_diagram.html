<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Sequence Diagram</title>
  </head>

  <body style="margin: 0; background: #f9fafb; font-family: system-ui">
    <!-- MAIN -->
    <div style="padding: 48px; max-width: 1100px; margin: auto">
      <h1 style="font-size: 32px; margin-bottom: 8px">
        Generate Sequence Diagram
      </h1>
      <p style="color: #6b7280; margin-bottom: 32px">
        Select a feature to preview its sequence diagram
      </p>

      <!-- FEATURE CARDS -->
      <div
        id="feature-container"
        style="
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          gap: 20px;
        "
      ></div>
    </div>

    <!-- MODAL -->
    <div
      id="modal"
      style="
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.4);
        align-items: center;
        justify-content: center;
        z-index: 50;
      "
    >
      <div
        style="
          background: #fff;
          width: 800px;
          max-width: 90%;
          border-radius: 10px;
          padding: 24px;
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <h3 id="modal-title" style="margin: 0">Sequence Diagram</h3>
          <button
            onclick="closeModal()"
            style="
              border: none;
              background: none;
              font-size: 20px;
              cursor: pointer;
            "
          >
            âœ•
          </button>
        </div>

        <pre
          id="plantuml-output"
          style="
            margin-top: 16px;
            background: #111827;
            color: #22c55e;
            padding: 16px;
            border-radius: 8px;
            overflow: auto;
          "
        ></pre>
      </div>
    </div>

    <!-- SCRIPT -->
    <script>
      /* =====================================================
   MODE 1: UI DUMMY (AKTIF SEKARANG)
   ===================================================== */
      const mockFeatures = [
        {
          id: 1,
          title: "User Login",
          plantuml: `
@startuml
actor User
User -> LoginPage : input email & password
LoginPage -> AuthController : submit
AuthController -> UserDB : validate
UserDB --> AuthController : success
AuthController --> LoginPage : login success
@enduml`,
        },
        {
          id: 2,
          title: "User Registration",
          plantuml: `
@startuml
actor User
User -> RegisterPage : input data
RegisterPage -> UserController : submit
UserController -> UserDB : save user
UserDB --> UserController : success
@enduml`,
        },
      ];

      renderCards(mockFeatures);

      /* =====================================================
   MODE 2: BACKEND (UNCOMMENT JIKA SUDAH READY)
   ===================================================== */

      /*
fetch("/api/sequence/features/")
  .then(res => res.json())
  .then(data => {
    renderCards(data);
  })
  .catch(err => {
    console.error("Failed to load features", err);
  });
*/

      /* =====================================================
   RENDER CARD FUNCTION
   ===================================================== */
      function renderCards(features) {
        const container = document.getElementById("feature-container");
        container.innerHTML = "";

        features.forEach((feature) => {
          const card = document.createElement("div");

          card.style = `
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:8px;
      padding:20px;
      cursor:pointer;
      transition:.2s;
    `;

          card.innerHTML = `
      <h3 style="margin:0 0 8px;">${feature.title}</h3>
      <p style="margin:0; color:#6b7280; font-size:14px;">
        Click to preview sequence diagram
      </p>
    `;

          card.onmouseenter = () =>
            (card.style.boxShadow = "0 8px 20px rgba(0,0,0,0.08)");
          card.onmouseleave = () => (card.style.boxShadow = "none");

          card.onclick = () => openModal(feature);

          container.appendChild(card);
        });
      }

      /* =====================================================
   MODAL HANDLER
   ===================================================== */
      function openModal(feature) {
        document.getElementById("modal").style.display = "flex";
        document.getElementById("modal-title").innerText = feature.title;

        /* MODE DUMMY */
        document.getElementById("plantuml-output").textContent =
          feature.plantuml;

        /* MODE BACKEND (UNCOMMENT NANTI) */
        /*
  fetch(`/api/sequence/${feature.id}/generate/`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("plantuml-output").textContent = data.plantuml;
    });
  */
      }

      function closeModal() {
        document.getElementById("modal").style.display = "none";
      }
    </script>
  </body>
</html>
